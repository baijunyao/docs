(window.webpackJsonp=window.webpackJsonp||[]).push([[54],{268:function(a,s,t){"use strict";t.r(s);var e=t(0),r=Object(e.a)({},function(){var a=this,s=a.$createElement,t=a._self._c||s;return t("ContentSlotsDistributor",{attrs:{"slot-key":a.$parent.slotKey}},[t("p",[a._v("想在线实验可以使用"),t("a",{attrs:{href:"https://cloud.tencent.com/developer/labs/lab/10433",target:"_blank",rel:"noopener noreferrer"}},[a._v("腾讯云开发者实验室"),t("OutboundLink")],1),a._v("；"),t("br"),a._v("\nelasticsearch 需要 java8 以上；"),t("br"),a._v("\n这里安装最新版的 java10 ；"),t("br"),a._v("\n下载 jdk")]),a._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token function"}},[a._v("wget")]),a._v(" --no-cookies --no-check-certificate --header "),t("span",{pre:!0,attrs:{class:"token string"}},[a._v('"Cookie: gpw_e24=http:%2F%2Fwww.oracle.com%2F; oraclelicense=accept-securebackup-cookie"')]),a._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[a._v('"http://download.oracle.com/otn-pub/java/jdk/10.0.1+10/fb4372174a714e6b8c52526dc134031e/jdk-10.0.1_linux-x64_bin.rpm"')]),a._v("  \n")])])]),t("p",[a._v("因为版本会一直升级；"),t("br"),a._v("\n如果执行上面这段代码返回了 ERROR 404: Not Found ；"),t("br"),a._v("\n那说明有新版本了；"),t("br"),a._v("\n那就自己去官网复制最新的下载链接；"),t("br"),a._v(" "),t("a",{attrs:{href:"http://www.oracle.com/technetwork/java/javase/downloads/jdk10-downloads-4416644.html",target:"_blank",rel:"noopener noreferrer"}},[a._v("http://www.oracle.com/technetwork/java/javase/downloads/jdk10-downloads-4416644.html"),t("OutboundLink")],1),a._v(" ;"),t("br"),a._v(" "),t("img",{attrs:{src:"/uploads/article/20180603/5b13f876ad730.jpg",alt:""}}),t("br"),a._v("\n选中 Accept License Agreement 然后在 jdk-10.0.1_linux-x64_bin.rpm 上右键复制链接地址；"),t("br"),a._v("\n替换上面命令中的下载链接；")]),a._v(" "),t("p",[a._v("安装 jdk 注意文件名要跟链接中的保持一直；")]),a._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token function"}},[a._v("sudo")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("rpm")]),a._v(" -ivh jdk-10.0.1_linux-x64_bin.rpm  \n")])])]),t("p",[a._v("能查看到版本号则表示安装成功；")]),a._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[a._v("java -version  \n")])])]),t("p",[a._v("下载 elasticsearch ；")]),a._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token function"}},[a._v("wget")]),a._v(" https://artifacts.elastic.co/downloads/elasticsearch/elasticsearch-6.2.4.rpm  \n")])])]),t("p",[a._v("安装 elasticsearch ；")]),a._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token function"}},[a._v("sudo")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("rpm")]),a._v(" -ivh elasticsearch-6.2.4.rpm  \n")])])]),t("p",[a._v("安装完成后编辑配置项")]),a._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token function"}},[a._v("vim")]),a._v(" /etc/elasticsearch/elasticsearch.yml  \n")])])]),t("p",[a._v("去掉下面三行的注释；")]),a._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[a._v("bootstrap.memory_lock: "),t("span",{pre:!0,attrs:{class:"token boolean"}},[a._v("true")]),a._v("  \nnetwork.host: 192.168.0.1  \nhttp.port: 9200  \n")])])]),t("p",[a._v("然后把 network.host 改成 "),t("code",[a._v("localhost")]),t("br"),a._v(" "),t("img",{attrs:{src:"/uploads/article/20180603/5b13f885156ea.jpg",alt:""}})]),a._v(" "),t("p",[a._v("启动 elasticsearch ；")]),a._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token function"}},[a._v("sudo")]),a._v(" systemctl daemon-reload  \n"),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("sudo")]),a._v(" systemctl "),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("enable")]),a._v(" elasticsearch.service  \n"),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("sudo")]),a._v(" systemctl start elasticsearch  \n")])])]),t("p",[a._v("稍等片刻给 elasticsearch 个启动的时间；"),t("br"),a._v("\n因为 elasticsearch 启动的略慢；"),t("br"),a._v("\n后续涉及到重启 elasticsearch 的时候也都记得稍等片刻；")]),a._v(" "),t("p",[a._v("然后查看 9200 端口检查是否成功启动；")]),a._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token function"}},[a._v("netstat")]),a._v(" -plntu  \n")])])]),t("p",[t("img",{attrs:{src:"/uploads/article/20180603/5b13f88f7ea53.jpg",alt:""}})]),a._v(" "),t("p",[a._v("如果半天过后仍然没有启动起来；"),t("br"),a._v("\n可能是内存不够出错；")]),a._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token function"}},[a._v("vim")]),a._v(" /etc/elasticsearch/jvm.options  \n")])])]),t("p",[a._v("把内存改为自己服务器内存的一半以下；"),t("br"),a._v("\n比如说这里改为 512M ；"),t("br"),a._v(" "),t("img",{attrs:{src:"/uploads/article/20180606/5b17771055b51.jpg",alt:""}}),t("br"),a._v("\n尝试启动；")]),a._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token function"}},[a._v("sudo")]),a._v(" systemctl restart elasticsearch  \n")])])]),t("p",[a._v("查看状态是否正常；")]),a._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token function"}},[a._v("curl")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[a._v("'localhost:9200'")]),a._v("  \n")])])]),t("p",[t("img",{attrs:{src:"/uploads/article/20180603/5b13f89b8e846.jpg",alt:""}})]),a._v(" "),t("p",[a._v("至此 elasticsearch 算是安装完成了；"),t("br"),a._v("\n但是如果想用来搜索中文；"),t("br"),a._v("\n还需要安装中文分词；"),t("br"),a._v("\n怎么算分词呢？"),t("br"),a._v(" "),t("a",{attrs:{href:"https://baijunyao.com/article/153",target:"_blank",rel:"noopener noreferrer"}},[a._v("全文搜索和中文分词"),t("OutboundLink")],1),a._v(" 文章中已经简单介绍过了；"),t("br"),a._v("\n这里我们从 elasticsearch 实战一遍；"),t("br"),a._v("\n比如说 "),t("code",[a._v("白俊遥技术博客")]),a._v(" 这句话；"),t("br"),a._v("\nelasticsearch内置的分词器对中文相当不友好；"),t("br"),a._v("\n只会一个只一个字的分；")]),a._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token function"}},[a._v("curl")]),a._v(" -H "),t("span",{pre:!0,attrs:{class:"token string"}},[a._v("'Content-Type: application/json'")]),a._v("  -XGET "),t("span",{pre:!0,attrs:{class:"token string"}},[a._v("'localhost:9200/_analyze?pretty'")]),a._v(" -d "),t("span",{pre:!0,attrs:{class:"token string"}},[a._v('\'{"text":"白俊遥技术博客"}\'')]),a._v("  \n")])])]),t("p",[t("img",{attrs:{src:"/uploads/article/20180603/5b13f8b4333cf.jpg",alt:""}})]),a._v(" "),t("p",[a._v("所以我们需要一个中文分词器；"),t("br"),a._v("\n这里选择和 elasticsearch 配套的 ik-analyzer ；")]),a._v(" "),t("p",[a._v("安装 ik-analyzer ；")]),a._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[a._v("/usr/share/elasticsearch/bin/elasticsearch-plugin "),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("install")]),a._v(" https://github.com/medcl/elasticsearch-analysis-ik/releases/download/v6.2.4/elasticsearch-analysis-ik-6.2.4.zip  \n")])])]),t("p",[a._v("如果报下面这种错误的话可能是网络不好；")]),a._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[a._v("Exception "),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("in")]),a._v(" thread "),t("span",{pre:!0,attrs:{class:"token string"}},[a._v('"main"')]),a._v(" java.net.ConnectException: Connection timed out "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),a._v("Connection timed out"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v("  \nat java.base/jdk.internal.reflect.NativeConstructorAccessorImpl.newInstance0"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),a._v("Native Method"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v("  \n")])])]),t("p",[a._v("沐浴更衣大念帅白最帅；"),t("br"),a._v("\n再试几次即可；")]),a._v(" "),t("p",[a._v("然后重新启动下服务；")]),a._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token function"}},[a._v("sudo")]),a._v(" systemctl restart elasticsearch  \n")])])]),t("p",[a._v("看下 ik-analyzer 的效果；")]),a._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token function"}},[a._v("curl")]),a._v(" -H "),t("span",{pre:!0,attrs:{class:"token string"}},[a._v("'Content-Type: application/json'")]),a._v("  -XGET "),t("span",{pre:!0,attrs:{class:"token string"}},[a._v("'localhost:9200/_analyze?pretty'")]),a._v(" -d "),t("span",{pre:!0,attrs:{class:"token string"}},[a._v('\'{"analyzer":"ik_max_word","text":"白俊遥技术博客"}\'')]),a._v("  \n")])])]),t("p",[t("img",{attrs:{src:"/uploads/article/20180603/5b13f8d104254.jpg",alt:""}}),t("br"),a._v("\n我们可以看到 技术 和 博客 两个词语已经成功组合到了一起；"),t("br"),a._v("\n然而本博主 白俊遥 的名字被硬生生的拆成了3个字这怎么忍；")]),a._v(" "),t("p",[a._v("还好强大的 analysis-ik 支持自定义词库；"),t("br"),a._v("\n增加自定义词库；")]),a._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token function"}},[a._v("vim")]),a._v(" /etc/elasticsearch/analysis-ik/IKAnalyzer.cfg.xml  \n")])])]),t("p",[t("img",{attrs:{src:"/uploads/article/20180603/5b13f8e5b6947.jpg",alt:""}}),t("br"),a._v("\n增加一个 白俊遥 到词库；")]),a._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("echo")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[a._v("'白俊遥'")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),a._v(" /etc/elasticsearch/analysis-ik/baijunyao.dic  \n")])])]),t("p",[a._v("重新启动下服务；")]),a._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token function"}},[a._v("sudo")]),a._v(" systemctl restart elasticsearch  \n")])])]),t("p",[a._v("再看下分词效果 ；")]),a._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token function"}},[a._v("curl")]),a._v(" -H "),t("span",{pre:!0,attrs:{class:"token string"}},[a._v("'Content-Type: application/json'")]),a._v("  -XGET "),t("span",{pre:!0,attrs:{class:"token string"}},[a._v("'localhost:9200/_analyze?pretty'")]),a._v(" -d "),t("span",{pre:!0,attrs:{class:"token string"}},[a._v('\'{"analyzer":"ik_max_word","text":"白俊遥技术博客"}\'')]),a._v("  \n")])])]),t("p",[t("img",{attrs:{src:"/uploads/article/20180603/5b13f8fe670c5.jpg",alt:""}}),t("br"),a._v("\n双击 666 ；")]),a._v(" "),t("p",[a._v("回到项目增加配置项；"),t("br"),a._v("\n/.env ;")]),a._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[a._v("SCOUT_DRIVER"),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v("elasticsearch\n")])])]),t("p",[a._v("生成索引；")]),a._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[a._v("php artisan elasticsearch:import "),t("span",{pre:!0,attrs:{class:"token string"}},[a._v('"App\\Models\\Article"')]),a._v("\n")])])])])},[],!1,null,null,null);s.default=r.exports}}]);